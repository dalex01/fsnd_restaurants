<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge">
  		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<title>Restaurants</title>
  		<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
    	<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap-theme.min.css">
    	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    	<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    	<!--LOAD PRE-REQUISITES FOR GOOGLE SIGN IN -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script src="//apis.google.com/js/platform.js?onload=start"> </script>
		<!-- END PRE-REQUISITES FOR GOOGLE SIGN IN -->
		<link rel=stylesheet type=text/css href="{{ url_for('static', filename='styles.css') }}">
	</head>
	<body>

		<div class="modal" id="trailer">
      		<div class="modal-dialog">
        		<div class="modal-content">
          			<a href="#" class="hanging-close" data-dismiss="modal" aria-hidden="true">
            			<img src="https://lh5.ggpht.com/v4-628SilF0HtHuHdu5EzxD7WRqOrrTIDi_MhEG6_qkNtUK5Wg7KPkofp_VJoF7RS2LhxwEFCO1ICHZlc-o_=s0#w=24&h=24"/>
          			</a>
          			<div class="scale-media" id="trailer-video-container">
          			</div>
        		</div>
      		</div>
    	</div>
    	<!-- Main Page Content -->
    	<div class="container">
      		<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        		<div class="container">
          			<div class="navbar-header">
          				<a class="navbar-brand" href="/">Restaurant's Menu Catalog</a>
          			</div>
        		</div>
      		</div>
    	</div>
    	<div class="container">
			<div id="signInButton" class="loginButtons box">
		        <span class="g-signin"
	    	          data-scope="openid email"
	            	  data-clientid="491700380670-39drtnm1d8rgqrm5d03ggtcmaepgalc5.apps.googleusercontent.com"
	            	  data-redirecturi="postmessage"
		              data-accesstype="offline"
	    	          data-cookiepolicy="single_host_origin"
	         	      data-callback="signInCallback"
	            	  data-approvalprompt="force">
	          	</span>
	        </div>
	        <div id="result box"></div>
	    </div>
		<script>
			function signInCallback(authResult) {
  				if (authResult['code']) {
    				// Hide the sign-in button now that the user is authorized
    				$('#signinButton').attr('style', 'display: none');
    				// Send the one-time-use code to the server,
    				// if the server responds, write a 'login successful' message to the web page
    				// and then redirect back to the main restaurants page
    				$.ajax({
      					type: 'POST',
      					url: '/gconnect?state={{STATE}}',
      					processData: false,
      					data: authResult['code'],
      					contentType: 'application/octet-stream; charset=utf-8',
      					success: function(result) {
        					// Handle or verify the server response if necessary.
        					if (result) {
          						$('#result').html('Login Successful!</br>'+ result + '</br>Redirecting...')
         						setTimeout(function() {
          							window.location.href = "/restaurants";
         						}, 4000);
						    } else if (authResult['error']) {
    							console.log('There was an error: ' + authResult['error']);
  							} else {
        						$('#result').html('Failed to make a server-side call. Check your configuration and console.');
         					}
      					}
					});
    			}
    		}
    		window.fbAsyncInit = function() {
			    FB.init({
			        appId      : '548209065336971',
			        xfbml      : true,
			        version    : 'v2.5'
			    });
			};

    		(function(d, s, id){
			    var js, fjs = d.getElementsByTagName(s)[0];
			    if (d.getElementById(id)) {return;}
			    js = d.createElement(s); js.id = id;
			    js.src = "//connect.facebook.net/en_US/sdk.js";
			    fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
		</script>
		<!--END GOOGLE PLUS SIGN IN BUTTON -->
	</body>
</html>